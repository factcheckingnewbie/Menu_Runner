import { VerticalBox, HorizontalBox, Button, ListView, ScrollView } from "std-widgets.slint";

export struct MenuEntry {
    label: string,
    actions: [string],
    command-template: string,
}

export component MainWindow inherits Window {
    title: "Menu Runner";
    width: 400px;
    height: 500px;

    callback run_command(string, string);
    callback get_button_color(string, string) -> string;
    callback refresh();    
    in property <[MenuEntry]> menu_items;
    // Function to trigger UI refresh
 //   public function trigger_refresh() {
  public function trigger_refresh() {    
        self.refresh();
    }
    
    VerticalBox {
        Text {
            text: "Menu Runner";
            font-size: 24px;
            color: #4af;
            horizontal-alignment: TextHorizontalAlignment.center;
        }

        Rectangle {
            height: 3px;
            background: #ccc;
        }
// ////////////
// Button {
//       text: is-toggled ? "toggled" : "untoggled";
//       width: 120px;
//       checkable: true;
//       height: 40px;
//
//       clicked => {
//           is-toggled = !is-toggled;
//
//       }
//   }
// ////////////
        ScrollView {
            // This ScrollView will allow scrolling through all menu items
            VerticalBox {
                for menu_item in menu_items: VerticalBox {
                    Text {
                        text: menu_item.label;
                        font-size: 18px;
                        horizontal-alignment: TextHorizontalAlignment.center;
                        padding-top: 10px;
                        padding-bottom: 5px;
                        color: #4cf;
                    }

                    HorizontalBox {
                        alignment: LayoutAlignment.center;
                        spacing: 3px;


                        property <bool> is-toggled: false;
                        for action in menu_item.actions: Button {
                            // text: action;
                            text: is-toggled ? "toggled" : action ;
                            checkable: true;
                            property <string> current-action: action;
                            clicked => {
                               is-toggled = !is-toggled;
                                // Explicitly use the action from the loop's current scope
                                root.run_command(menu_item.command-template, self.current-action);
                            }
                        }
                    }

                    Rectangle {
                        height: 3px;
                        background: #eee;
                    }
                }
            }
        }
    }
}
